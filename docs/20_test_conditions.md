# テスト条件 - チケット管理アプリ

- 文書ID：TCND-TICKET-001
- 版：v0.5
- ステータス：Draft
- 最終更新日：2026-01-20
- 作成者：仁後慎太郎
- 対象：チケット管理アプリ（Web, Django + SQLite）
- 関連：
  - テスト計画：`../docs/10_test_plan.md`
  - テストケース：`../testcases/testcases.csv`
  - 要件とテストのトレーサビリティ：`../docs/70_requirements_test_traceability.md`

---

## 1. 目的

本ドキュメントは、要件（RQ）から検証可能な単位へ分解した「テスト条件（TCND）」を定義し、
テストケース（TC）作成・優先度付けの基準を統一することを目的とする。

---

## 2. 本書の守備範囲（重複排除）

- 本書（20）：**テスト条件（TCND）の定義**（優先度・リスク分類・条件文）
- トレーサビリティ（70）：**RQ → TCND → TC** の対応と **要件カバレッジ** を管理（一次ソース）
- テストケースCSV（testcases.csv）：**TCND → TC** の対応（テスト設計・実行の一次ソース）

※本書に「対応TC」を保持すると、70・CSVと二重管理になりズレやすいため、本書では保持しない。

---

## 3. 優先度の考え方

- P1：最優先（権限／状態遷移／整合性に直結、または致命的な障害につながる）
- P2：高（主要フローの品質に強く影響）
- P3：中（補助機能、表示・利便性など）

---

## 4. 命名規則

- 命名規則：`TCND-XXX`
- 1条件＝「何を確かめるか」を1文で表す（テストケースより上位の粒度）
- 例：`RQ-015 → TCND-002 → TC-002/TC-003` のように追跡できることを意識する  
  ※追跡の一次ソースは 70（トレーサビリティ）および `../testcases/testcases.csv`

---

## 5. テスト条件一覧（採用）

IDが連番になっていない箇所（例：011/012/031/034/038/039/042/044）は、Backlog（保留）として管理している。

| ID | 優先度 | リスク | テスト条件 |
| --- | --- | --- | --- |
| TCND-001 | P1 | 権限 | 依頼者は自分のチケット詳細のみ参照できる |
| TCND-002 | P1 | 権限 | 依頼者は他人のチケット詳細にアクセスできない（直接URL/ID指定含む） |
| TCND-003 | P1 | 権限 | 依頼者はステータス変更できない（UI/直接操作の双方） |
| TCND-004 | P1 | 権限 | 担当者は全チケットを参照できる（仕様どおり） |
| TCND-005 | P1 | 権限 | 担当割当（Assign）は管理者のみ実行できる |
| TCND-006 | P1 | 状態遷移 | Open→In Progress / Pending の許可遷移ができる |
| TCND-007 | P1 | 状態遷移 | In Progress→Pending / Resolved の許可遷移ができる |
| TCND-008 | P1 | 状態遷移 | Pending→In Progress の許可遷移ができる |
| TCND-009 | P1 | 状態遷移 | Resolved→Closed の許可遷移ができる |
| TCND-010 | P1 | 状態遷移 | 禁止遷移（例：Open→Closed、Closed→任意）は拒否される |
| TCND-013 | P2 | 入力 | 依頼者が必須項目を満たしてチケットを作成できる |
| TCND-014 | P2 | 入力 | 必須不足の場合、作成できずエラーが表示される |
| TCND-015 | P2 | 入力 | タイトルの境界値（最大長ちょうど/超過）の受理・拒否が正しい |
| TCND-016 | P2 | 入力 | 本文の境界値（最大長ちょうど/超過）の受理・拒否が正しい |
| TCND-017 | P2 | 入力 | 期限が過去日の場合、作成できずエラーとなる |
| TCND-018 | P2 | 入力 | 添付ファイル：サイズ上限超過は拒否される |
| TCND-019 | P2 | 入力 | 添付ファイル：許可形式以外は拒否される（または安全に扱われる） |
| TCND-020 | P2 | 検索 | 依頼者の一覧には自分のチケットのみ表示される |
| TCND-021 | P2 | 検索 | キーワード検索（部分一致）が期待どおりに絞り込める |
| TCND-022 | P2 | 検索 | 状態フィルタが期待どおりに絞り込める |
| TCND-023 | P2 | 検索 | ソート（更新日時など）が期待どおりである |
| TCND-024 | P2 | 履歴 | コメントを追加でき、詳細画面に表示される |
| TCND-025 | P2 | 履歴 | ステータス変更が履歴として残り、表示される |
| TCND-026 | P3 | 表示 | 権限がない操作は、分かりやすい抑止表示またはエラーとなる |
| TCND-027 | P3 | 検索 | 件数が多い場合でも一覧表示が破綻しない（簡易確認） |
| TCND-028 | P3 | 表示 | エラー文言がユーザに理解可能な内容になっている（簡易確認） |
| TCND-029 | P1 | 権限/認証 | ログイン必須（未ログインは一覧/詳細/作成/更新/コメントにアクセスできない） |
| TCND-030 | P2 | 履歴 | 監査ログ（履歴）一覧がチケット詳細で閲覧できる（閲覧権限に従う） |
| TCND-032 | P2 | 入力 | 添付は作成後に削除/差し替えできない（UIなし/直叩き拒否） |
| TCND-033 | P1 | 認可 | Agentはチケットを作成できない（UIなし/直叩き拒否） |
| TCND-035 | P1 | 認可 | Adminは全チケットを閲覧できる（一覧/詳細） |
| TCND-036 | P2 | 表示 | 詳細画面の表示項目（title/body/status/due_date/assignee/attachment）が仕様どおり |
| TCND-037 | P1 | 認可 | Requesterは他人チケットにコメントできない（UI/直叩き拒否） |
| TCND-040 | P1 | 認可 | Agentは担当チケットのみステータス変更できる（非担当は拒否） |
| TCND-041 | P1 | 制約 | 担当未割当チケットはAgentがステータス変更できない |
| TCND-043 | P2 | 履歴 | 監査ログの操作種別（CREATED/STATUS_CHANGED/ASSIGNED/COMMENT_ADDED等）が正しく記録される |

---

## 6. Backlog（保留：今後追加/採否判断）

| ID | 優先度 | リスク | テスト条件案 | 関連（RQ/R） | 状態 |
| --- | --- | --- | --- | --- | --- |
| TCND-011 | P1 | 整合性 | 同一チケットを別セッションで更新したとき、整合性が破綻しない（競合時の扱いが仕様どおり） | R-03 | 保留 |
| TCND-012 | P1 | 整合性 | 同時にステータス変更が走っても、最終状態と履歴が整合する | R-03 | 保留 |
| TCND-031 | P2 | 入力 | 添付は1ファイルのみ（複数添付は拒否） | RQ-008 | 保留 |
| TCND-034 | P2 | 認可 | Adminはチケットを作成できる（運用上必要なら） | RQ-014 | 保留 |
| TCND-038 | P2 | 機能 | Adminは任意チケットにコメントできる | RQ-024 | 保留 |
| TCND-039 | P1 | 認可 | Requesterは期限変更できない（更新UIなし/直叩き拒否） | RQ-028 | 保留 |
| TCND-042 | P1 | 認可 | Adminは全チケットを更新できる（status/assignee/due_date等） | RQ-032 | 保留 |
| TCND-044 | P2 | 入力 | statusの初期値（Open）および不正値（列挙外）の扱いが仕様どおり | RQ-005 | 保留 |

---

## 7. 次の成果物への紐づけ

- 各テスト条件（TCND-XXX）に対し、テストケース（TC-XXX）を `../testcases/testcases.csv` で作成・管理する
- 要件とテストの対応（RQ→TCND→TC）および要件カバレッジは `../docs/70_requirements_test_traceability.md` を一次ソースとして更新する
