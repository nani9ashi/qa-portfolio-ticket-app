# 要件とテストのトレーサビリティ - チケット管理アプリ

- 文書ID：RTT-TICKET-001
- 版：v0.2
- ステータス：Draft
- 最終更新日：2026-01-19
- 作成者：仁後慎太郎
- 対象：チケット管理アプリ（Web, Django + SQLite）
- 関連：
  - 要件（正本）：`../requirements/requirements.csv`（詳細版：RQ-001〜RQ-042）
  - テスト条件：`20_test_conditions.md`（TCND-001〜）
  - テストケース：`../testcases/testcases.csv`（TC-001〜）
  - テスト結果：`../results/test_results.csv`
  - 欠陥ログ：`../defects/defect_log.csv`

---

## 1. 目的

本ドキュメントは、「要件 → テスト条件 → テストケース」の対応関係を明示し、カバレッジ（未カバー/一部/カバー）と残存リスクを可視化する。

---

## 2. ID体系（採番）

- 要件ID：`RQ-XXX`（例：RQ-015）
- テスト条件ID：`TCND-XXX`（例：TCND-002）
- テストケースID：`TC-XXX`（例：TC-003）
- テスト結果ID：`TR-XXXX`（例：TR-0002）
- 欠陥ID：`DEFECT-XXX`（例：DEFECT-001）

---

## 3. トレーサビリティの考え方

- **要件（RQ）**：何を満たすべきか（期待結果の根拠）
- **テスト条件（TCND）**：要件を検証可能な単位へ分解した「確認テーマ」
- **テストケース（TC）**：具体手順と期待値（実行可能な最小単位）

本書では、まず RQ→TCND を定義し、次に TCND→TC を紐づけることで、RQ→TC（派生）を導出する。

---

## 4. カバレッジの定義

- **カバー**：対応するTCNDが定義され、かつ該当TCが存在する
- **一部**：一部TCが存在するが、要件の全受入条件（粒度/例外/ロール等）が未検証、またはTCND/TCが不足
- **未カバー**：対応するTCNDまたはTCが未定義（＝現時点で検証できていない）

---

## 5. 要件（RQ）→テスト条件（TCND）→テストケース（TC）　対応

| 要件ID | 要件（概要） | 優先度 | 関連TCND | 関連TC（派生） | カバレッジ | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| RQ-001 | ログイン必須 | Must | - | - | 未カバー |  |
| RQ-002 | 全操作は監査ログに残る | Must | TCND-024;TCND-025 | TC-030 | 一部 | コメント/ステータスの「履歴」期待はあるが、監査ログの粒度（操作種別）や網羅は未検証。監査ログ表示はRQ-042参照。 |
| RQ-003 | チケットのtitleは必須かつ最大80文字 | Must | TCND-013;TCND-014;TCND-015 | TC-020;TC-021;TC-022;TC-023 | カバー |  |
| RQ-004 | チケットのbodyは必須かつ最大4000文字 | Must | TCND-013;TCND-014;TCND-016 | TC-020;TC-021 | 一部 | 本文の境界値（最大長ちょうど/超過）のテストケースが未作成（TCND-016が未カバー）。 |
| RQ-005 | statusは必須で初期値Open | Must | TCND-013;TCND-006;TCND-007;TCND-008;TCND-009;TCND-010 | TC-009;TC-010;TC-011;TC-012;TC-013;TC-014;TC-015;TC-020 | 一部 | 初期値Openや不正ステータス拒否（列挙制約）は明示テスト未作成。 |
| RQ-006 | due_dateは任意で過去日不可 | Must | TCND-017 | TC-024 | 一部 | 要件ロールはAdminだが、現行TCはRequester作成時の過去日を検証。運用/要件の整合が必要。 |
| RQ-007 | assigneeは任意でAdminのみ設定/変更できる | Must | TCND-005 | TC-007;TC-008 | カバー |  |
| RQ-008 | 添付は任意で1ファイルのみ | Must | TCND-018 | TC-025 | 一部 | 「1ファイルのみ（複数添付不可）」の異常系テストが未作成。サイズ/形式は別要件で確認。 |
| RQ-009 | 添付は拡張子制限がある | Must | TCND-019 | TC-026 | カバー |  |
| RQ-010 | 添付はサイズ上限5MB | Must | TCND-018 | TC-025 | カバー |  |
| RQ-011 | 添付は作成時のみ付与でき、差し替え/削除は不可 | Must | - | - | 未カバー | 作成後の削除/差し替え不可（UI/サーバ拒否）の確認が未実施。 |
| RQ-012 | Requesterは自分名義でチケット作成できる | Must | TCND-013 | TC-020 | カバー |  |
| RQ-013 | Agentはチケットを作成できない | Must | - | - | 未カバー | 作成UIの非表示/直叩き拒否（Agent）を確認するTC未作成。 |
| RQ-014 | Adminはチケットを作成できる（更新権限に含む） | Should | - | - | 未カバー | Admin作成はShould。実装/運用方針によりTC追加または対象外化を判断。 |
| RQ-015 | Requesterは自分のチケットのみ閲覧できる | Must | TCND-001;TCND-002;TCND-020 | TC-001;TC-002;TC-003;TC-027 | カバー |  |
| RQ-016 | Agentは全チケットを閲覧できる | Must | TCND-004 | TC-006 | カバー |  |
| RQ-017 | Adminは全チケットを閲覧できる | Must | - | - | 未カバー | Adminの閲覧権限（一覧/詳細）を確認するTC未作成。 |
| RQ-018 | 検索（q）でtitle/body部分一致ができる | Must | TCND-021 | TC-028 | カバー |  |
| RQ-019 | 状態フィルタでstatus絞り込みができる | Must | TCND-022 | TC-029 | カバー |  |
| RQ-020 | 詳細画面に主要項目を表示する | Must | - | - | 未カバー | 表示項目の網羅（title/body/status/due_date/assignee/attachment）を確認するTCND/TC未作成。 |
| RQ-021 | Requesterは自分のチケットにコメント追加できる | Must | TCND-024 | TC-030 | カバー |  |
| RQ-022 | Requesterは他人のチケットにコメントできない | Must | - | - | 未カバー | Requesterが他人チケットにコメントできない確認（UI/直叩き）が未実施。 |
| RQ-023 | Agentは任意のチケットにコメント追加できる | Must | TCND-024 | TC-030 | カバー |  |
| RQ-024 | Adminは任意のチケットにコメント追加できる | Must | - | - | 未カバー | Adminが任意チケットにコメントできる確認が未実施。 |
| RQ-025 | コメント追加は監査ログにCOMMENT_ADDEDとして残る | Must | TCND-024;TCND-025 | TC-030 | 一部 | COMMENT_ADDEDの種別まで含めた監査ログ検証は未実施（表示/データ確認が必要）。 |
| RQ-026 | Requesterはステータス変更できない | Must | TCND-003 | TC-004;TC-005 | カバー |  |
| RQ-027 | Requesterは担当者割当できない | Must | TCND-005 | TC-007;TC-008 | 一部 | Requesterの担当割当不可は未検証（Agentでの不可はTC-008で確認）。 |
| RQ-028 | Requesterは期限変更できない | Must | - | - | 未カバー | Requesterの期限変更不可は未検証（更新画面/直叩き拒否）。 |
| RQ-029 | Agentは担当チケットのみ更新できる | Must | - | - | 未カバー | Agentの更新可否が「担当のみ」であること（非担当の拒否）が未検証。 |
| RQ-030 | Agentは担当者割当できない | Must | TCND-005 | TC-007;TC-008 | カバー |  |
| RQ-031 | Agentは期限変更できない（任意固定） | Should | - | - | 未カバー | Agentの期限変更不可（Should）を確認するTC未作成。 |
| RQ-032 | Adminは全チケットを更新できる | Must | - | - | 未カバー | Adminの更新権限（status/assignee/due_date等）を包括的に確認するTC未作成。 |
| RQ-033 | Adminは未割当チケットをAgentへ割り当てできる | Must | TCND-005 | TC-007;TC-008 | カバー |  |
| RQ-034 | 担当未割当のチケットはAgentがステータス変更できない | Must | - | - | 未カバー | 担当未割当チケットでAgentがステータス変更できない確認が未実施。 |
| RQ-035 | 許可された遷移のみ可能 | Must | TCND-006;TCND-007;TCND-008;TCND-009;TCND-010 | TC-009;TC-010;TC-011;TC-012;TC-013;TC-014;TC-015 | カバー |  |
| RQ-036 | Open→In Progress / Pending が可能 | Must | TCND-006 | TC-009;TC-010 | カバー |  |
| RQ-037 | In Progress→Resolved / Pending が可能 | Must | TCND-007 | TC-011 | カバー |  |
| RQ-038 | Pending→In Progress が可能 | Must | TCND-008 | TC-012 | カバー |  |
| RQ-039 | Resolved→Closed が可能 | Must | TCND-009 | TC-013 | カバー |  |
| RQ-040 | Open→Closed は禁止 | Must | TCND-010 | TC-014;TC-015 | カバー |  |
| RQ-041 | Closedからの遷移はすべて禁止 | Must | TCND-010 | TC-014;TC-015 | カバー |  |
| RQ-042 | 監査ログ（履歴）一覧を閲覧できる | Should | - | - | 未カバー | 監査ログ（履歴）一覧の表示確認が未実施（TCND-025/TC追加が必要）。 |

---

## 6. テスト条件（TCND）→テストケース（TC）対応

| TCND ID | 優先度 | リスク | テスト条件 | 関連RQ | 関連TC | カバレッジ |
| --- | --- | --- | --- | --- | --- | --- |
| TCND-001 | P1 | 権限 | 依頼者は自分のチケット詳細のみ参照できる | RQ-015 | TC-001 | カバー |
| TCND-002 | P1 | 権限 | 依頼者は他人のチケット詳細にアクセスできない（直接URL/ID指定含む） | RQ-015;RQ-022 | TC-002;TC-003 | カバー |
| TCND-003 | P1 | 権限 | 依頼者はステータス変更できない（UI/直接操作の双方） | RQ-026 | TC-004;TC-005 | カバー |
| TCND-004 | P1 | 権限 | 担当者は全チケットを参照できる（仕様どおり） | RQ-016 | TC-006 | カバー |
| TCND-005 | P1 | 権限 | 担当割当（Assign）は管理者のみ実行できる | RQ-007;RQ-027;RQ-030;RQ-033 | TC-007;TC-008 | カバー |
| TCND-006 | P1 | 状態遷移 | Open→In Progress / Pending の許可遷移ができる | RQ-035;RQ-036 | TC-009;TC-010 | カバー |
| TCND-007 | P1 | 状態遷移 | In Progress→Pending / Resolved の許可遷移ができる | RQ-035;RQ-037 | TC-011 | カバー |
| TCND-008 | P1 | 状態遷移 | Pending→In Progress の許可遷移ができる | RQ-035;RQ-038 | TC-012 | カバー |
| TCND-009 | P1 | 状態遷移 | Resolved→Closed の許可遷移ができる | RQ-035;RQ-039 | TC-013 | カバー |
| TCND-010 | P1 | 状態遷移 | 禁止遷移（例：Open→Closed、Closed→任意）は拒否される | RQ-035;RQ-040;RQ-041 | TC-014;TC-015 | カバー |
| TCND-011 | P1 | 整合性 | 同一チケットを別セッションで更新したとき、整合性が破綻しない（競合時の扱いが仕様どおり） | - | TC-016;TC-017 | カバー |
| TCND-012 | P1 | 整合性 | 同時にステータス変更が走っても、最終状態と履歴が整合する | - | TC-018;TC-019 | カバー |
| TCND-013 | P2 | 入力 | 依頼者が必須項目を満たしてチケットを作成できる | RQ-003;RQ-004;RQ-005;RQ-012 | TC-020 | カバー |
| TCND-014 | P2 | 入力 | 必須不足の場合、作成できずエラーが表示される | RQ-003;RQ-004 | TC-021 | カバー |
| TCND-015 | P2 | 入力 | タイトルの境界値（最大長ちょうど/超過）の受理・拒否が正しい | RQ-003 | TC-022;TC-023 | カバー |
| TCND-016 | P2 | 入力 | 本文の境界値（最大長ちょうど/超過）の受理・拒否が正しい | RQ-004 | - | 未カバー |
| TCND-017 | P2 | 入力 | 期限が過去日の場合、作成できずエラーとなる | RQ-006 | TC-024 | カバー |
| TCND-018 | P2 | 入力 | 添付ファイル：サイズ上限超過は拒否される | RQ-008;RQ-010 | TC-025 | カバー |
| TCND-019 | P2 | 入力 | 添付ファイル：許可形式以外は拒否される（または安全に扱われる） | RQ-009 | TC-026 | カバー |
| TCND-020 | P2 | 検索 | 依頼者の一覧には自分のチケットのみ表示される | RQ-015 | TC-027 | カバー |
| TCND-021 | P2 | 検索 | キーワード検索（部分一致）が期待どおりに絞り込める | RQ-018 | TC-028 | カバー |
| TCND-022 | P2 | 検索 | 状態フィルタが期待どおりに絞り込める | RQ-019 | TC-029 | カバー |
| TCND-023 | P2 | 検索 | ソート（更新日時など）が期待どおりである | - | - | 未カバー |
| TCND-024 | P2 | 履歴 | コメントを追加でき、詳細画面に表示される | RQ-002;RQ-021;RQ-023;RQ-024;RQ-025 | TC-030 | カバー |
| TCND-025 | P2 | 履歴 | ステータス変更が履歴として残り、表示される | RQ-002;RQ-025;RQ-042 | - | 未カバー |
| TCND-026 | P3 | 表示 | 権限がない操作は、分かりやすい抑止表示またはエラーとなる | - | - | 未カバー |
| TCND-027 | P3 | 検索 | 件数が多い場合でも一覧表示が破綻しない（簡易確認） | - | - | 未カバー |
| TCND-028 | P3 | 表示 | エラー文言がユーザに理解可能な内容になっている（簡易確認） | - | - | 未カバー |

---

## 7. カバレッジ

要件（全42件）に対し、現行のテスト条件/テストケースでのカバレッジは以下。

- カバー：21件
- 一部カバー：7件
- 未カバー：14件

- 未カバー要件：RQ-001;RQ-011;RQ-013;RQ-014;RQ-017;RQ-020;RQ-022;RQ-024;RQ-028;RQ-029;RQ-031;RQ-032;RQ-034;RQ-042
- 一部カバー要件：RQ-002;RQ-004;RQ-005;RQ-006;RQ-008;RQ-025;RQ-027

---

## 8. 未カバー/一部カバーの扱い

未カバー/一部カバーは、以下のどれかに必ず分類して扱う。

- **A. テスト条件・テストケースを追加してカバーする**（Mustの要件、リスク優先）
- **B. スコープ外として明記する**（MVP外、将来機能、工数都合など）
- **C. 要件自体を修正・明確化する**（ロール/運用/実装がズレている等）

特に、現状のズレとして以下は早めに整理する。
- `RQ-006（due_dateはAdmin）` と、現行TC（Requester作成でdue_date入力）の前提が一致していない  
  → **「作成時はRequesterも入力可」なのか、「Adminのみ」なのか**を決め、要件/TC/実装を揃える。
- 監査ログ（`RQ-002/RQ-025/RQ-042`）は「履歴が残る」期待はあるが、**操作種別や表示**まで含めた検証が未完。

---

## 9. 追加候補のテスト条件（Backlog）

| 追加候補TCND | 優先度 | リスク | テスト条件案 | 対象要件 | 対応TC案 |
| --- | --- | --- | --- | --- | --- |
| TCND-029 | P1 | 権限/認証 | ログイン必須（未ログインは一覧/詳細/作成/更新/コメントにアクセスできない） | RQ-001 | TC-追加 |
| TCND-030 | P2 | 履歴 | 監査ログ（履歴）一覧がチケット詳細で閲覧できる（閲覧権限に従う） | RQ-042 | TC-追加 |
| TCND-031 | P2 | 入力 | 添付は1ファイルのみ（複数添付は拒否） | RQ-008 | TC-追加 |
| TCND-032 | P2 | 入力 | 添付は作成後に削除/差し替えできない（UIなし/直叩き拒否） | RQ-011 | TC-追加 |
| TCND-033 | P1 | 認可 | Agentはチケットを作成できない（UIなし/直叩き拒否） | RQ-013 | TC-追加 |
| TCND-034 | P2 | 認可 | Adminはチケットを作成できる（運用上必要なら） | RQ-014 | TC-追加 |
| TCND-035 | P1 | 認可 | Adminは全チケットを閲覧できる（一覧/詳細） | RQ-017 | TC-追加 |
| TCND-036 | P2 | 表示 | 詳細画面の表示項目（title/body/status/due_date/assignee/attachment）が仕様どおり | RQ-020 | TC-追加 |
| TCND-037 | P1 | 認可 | Requesterは他人チケットにコメントできない（UI/直叩き拒否） | RQ-022 | TC-追加 |
| TCND-038 | P2 | 機能 | Adminは任意チケットにコメントできる | RQ-024 | TC-追加 |
| TCND-039 | P1 | 認可 | Requesterは期限変更できない（更新UIなし/直叩き拒否） | RQ-028 | TC-追加 |
| TCND-040 | P1 | 認可 | Agentは担当チケットのみ更新できる（非担当は拒否） | RQ-029 | TC-追加 |
| TCND-041 | P1 | 制約 | 担当未割当チケットはAgentがステータス変更できない | RQ-034 | TC-追加 |
| TCND-042 | P1 | 認可 | Adminは全チケットを更新できる（status/assignee/due_date等） | RQ-032 | TC-追加 |
| TCND-043 | P2 | 履歴 | 監査ログの操作種別（CREATED/STATUS_CHANGED/ASSIGNED/COMMENT_ADDED等）が正しく記録される | RQ-002;RQ-025 | TC-追加 |
| TCND-044 | P2 | 入力 | 本文の境界値（最大長ちょうど/超過）を確認する | RQ-004 | TC-追加 |

