# 要件とテストのトレーサビリティ - チケット管理アプリ

- 文書ID：RTT-TICKET-001
- 版：v0.2
- ステータス：Draft
- 最終更新日：2026-01-19
- 作成者：仁後慎太郎
- 対象：チケット管理アプリ（Web, Django + SQLite）
- 関連：
  - 要件：`../requirements/requirements.csv`（RQ-001～）
  - テスト条件：`../docs/20_test_conditions.md`（TCND-001〜）
  - テストケース：`../testcases/testcases.csv`（TC-001〜）
  - テスト計画：`../docs/10_test_plan.md`（R-01〜）
  - テスト結果：`../results/test_results.csv`（TR-0001～）
  - 欠陥ログ：`../defects/defect_log.csv`（DEFECT-001～）


---

## 1. 目的

本ドキュメントは、「要件 → テスト条件 → テストケース」の対応関係を明示し、カバレッジ（未カバー/一部/カバー）と残存リスクを可視化する。

---

## 2. ID体系（採番）

- 要件ID：`RQ-XXX`（例：RQ-015）
- テスト条件ID：`TCND-XXX`（例：TCND-002）
- テストケースID：`TC-XXX`（例：TC-003）
- リスクID：`R-XX`（例：R-01）
- テスト結果ID：`TR-XXXX`（例：TR-0002）
- 欠陥ID：`DEFECT-XXX`（例：DEFECT-001）


---

## 3. トレーサビリティの考え方

- **要件（RQ）**：何を満たすべきか（期待結果の根拠）
- **テスト条件（TCND）**：要件を検証可能な単位へ分解した「確認テーマ」
- **テストケース（TC）**：具体手順と期待値（実行可能な最小単位）
- **リスク（R）**：品質上の懸念を整理したもの。テストの優先度付け・追加観点の根拠として参照する

本書では、まず RQ→TCND を定義し、次に TCND→TC を紐づけることで、RQ→TCを導出する。
また本書では、Rのトレーサビリティは管理しない。

---

## 4. カバレッジの定義

- **カバー**：対応するTCNDが定義され、かつ該当TCが存在する
- **一部**：一部TCが存在するが、要件の全受入条件（粒度/例外/ロール等）が未検証、またはTCND/TCが不足
- **未カバー**：対応するTCNDまたはTCが未定義（＝現時点で検証できていない）

---

## 5. 要件（RQ）→テスト条件（TCND）→テストケース（TC）　対応

| 要件ID | 要件（概要） | 優先度 | 関連TCND | 関連TC（派生） | カバレッジ | 備考 |
| --- | --- | --- | --- | --- | --- | --- |
| RQ-001 | ログイン必須 | Must | TCND-029 | TC-031;TC-032;TC-033 | カバー | 未ログイン時の一覧/詳細/作成を対象に確認する。 |
| RQ-002 | 全操作は監査ログに残る | Must | TCND-043;TCND-025 | TC-040 | 一部 | 主要操作（作成/割当/ステータス変更/コメント）で確認。全操作の網羅（例：期限変更など）は未実施。 |
| RQ-003 | チケットのtitleは必須かつ最大80文字 | Must | TCND-013;TCND-014;TCND-015 | TC-020;TC-021;TC-022;TC-023 | カバー |  |
| RQ-004 | チケットのbodyは必須かつ最大4000文字 | Must | TCND-013;TCND-014;TCND-016 | TC-020;TC-021 | 一部 | 本文の境界値（最大長ちょうど/超過）のテストケースが未作成（TCND-044相当）。 |
| RQ-005 | statusは必須で初期値Open | Must | TCND-013;TCND-006;TCND-007;TCND-008;TCND-009;TCND-010 | TC-009;TC-010;TC-011;TC-012;TC-013;TC-014;TC-015;TC-020 | 一部 | 初期値Open/不正ステータス拒否（列挙制約）の明示テストは未作成。 |
| RQ-006 | due_dateは任意で過去日不可 | Must | TCND-017 | TC-024 | 一部 | 要件ロールはAdminだが、現行TCはRequester作成時の過去日入力で検証。要件/実装/TCの整合要確認。 |
| RQ-007 | assigneeは任意でAdminのみ設定/変更できる | Must | TCND-005 | TC-007;TC-008 | カバー |  |
| RQ-008 | 添付は任意で1ファイルのみ | Must | TCND-018;TCND-031 | TC-025 | 一部 | サイズ/形式は確認済。複数添付不可（1ファイルのみ）の異常系は未作成。 |
| RQ-009 | 添付は拡張子制限がある | Must | TCND-019 | TC-026 | カバー |  |
| RQ-010 | 添付はサイズ上限5MB | Must | TCND-018 | TC-025 | カバー |  |
| RQ-011 | 添付は作成時のみ付与でき、差し替え/削除は不可 | Must | TCND-032 | TC-041 | カバー | UI不存在/拒否を確認（直叩きは任意）。 |
| RQ-012 | Requesterは自分名義でチケット作成できる | Must | TCND-013 | TC-020 | カバー |  |
| RQ-013 | Agentはチケットを作成できない | Must | TCND-033 | TC-034 | カバー | UI非表示または直叩き拒否。 |
| RQ-014 | Adminはチケットを作成できる（更新権限に含む） | Should | TCND-034 | - | 未カバー | Should。運用方針により追加 or 対象外化。 |
| RQ-015 | Requesterは自分のチケットのみ閲覧できる | Must | TCND-001;TCND-002;TCND-020 | TC-001;TC-002;TC-003;TC-027 | カバー |  |
| RQ-016 | Agentは全チケットを閲覧できる | Must | TCND-004 | TC-006 | カバー |  |
| RQ-017 | Adminは全チケットを閲覧できる | Must | TCND-035 | TC-035 | カバー |  |
| RQ-018 | 検索（q）でtitle/body部分一致ができる | Must | TCND-021 | TC-028 | カバー |  |
| RQ-019 | 状態フィルタでstatus絞り込みができる | Must | TCND-022 | TC-029 | カバー |  |
| RQ-020 | 詳細画面に主要項目を表示する | Must | TCND-036 | TC-039 | カバー | 未設定項目の表示（空/未設定表記）は許容。 |
| RQ-021 | Requesterは自分のチケットにコメント追加できる | Must | TCND-024 | TC-030 | カバー |  |
| RQ-022 | Requesterは他人のチケットにコメントできない | Must | TCND-037 | TC-036 | カバー | UI/直叩きいずれでも拒否されること。 |
| RQ-023 | Agentは任意のチケットにコメント追加できる | Must | TCND-024 | TC-030 | カバー |  |
| RQ-024 | Adminは任意のチケットにコメント追加できる | Must | TCND-038 | - | 未カバー | Adminでのコメント追加（任意チケット）を確認するTCが未作成。 |
| RQ-025 | コメント追加は監査ログにCOMMENT_ADDEDとして残る | Must | TCND-043;TCND-025 | TC-040 | カバー | 種別（COMMENT_ADDED）の識別までを確認対象とする。 |
| RQ-026 | Requesterはステータス変更できない | Must | TCND-003 | TC-004;TC-005 | カバー |  |
| RQ-027 | Requesterは担当者割当できない | Must | TCND-005 | TC-007;TC-008 | 一部 | 「管理者のみ割当」自体は確認。Requester視点（UI/直叩き拒否）の明示ケースは未作成。 |
| RQ-028 | Requesterは期限変更できない | Must | TCND-039 | - | 未カバー | 更新UI/直叩き拒否を確認するTC未作成。 |
| RQ-029 | Agentは担当チケットのみ更新できる | Must | TCND-040 | TC-037 | 一部 | 非担当の「ステータス変更」拒否は確認。更新定義（コメント追加も含む）の非担当拒否は未検証。 |
| RQ-030 | Agentは担当者割当できない | Must | TCND-005 | TC-008 | カバー |  |
| RQ-031 | Agentは期限変更できない（任意固定） | Should | - | - | 未カバー | Should。運用方針により追加 or 対象外化。 |
| RQ-032 | Adminは全チケットを更新できる | Must | TCND-042 | - | 未カバー | Adminの更新権限（status/assignee/due_date等）を包括的に確認するTC未作成。 |
| RQ-033 | Adminは未割当チケットをAgentへ割り当てできる | Must | TCND-005 | TC-007 | カバー |  |
| RQ-034 | 担当未割当のチケットはAgentがステータス変更できない | Must | TCND-041 | TC-038 | カバー |  |
| RQ-035 | 許可された遷移のみ可能 | Must | TCND-006;TCND-007;TCND-008;TCND-009;TCND-010 | TC-009;TC-010;TC-011;TC-012;TC-013;TC-014;TC-015 | カバー |  |
| RQ-036 | Open→In Progress / Pending が可能 | Must | TCND-006 | TC-009;TC-010 | カバー |  |
| RQ-037 | In Progress→Resolved / Pending が可能 | Must | TCND-007 | TC-011 | カバー |  |
| RQ-038 | Pending→In Progress が可能 | Must | TCND-008 | TC-012 | カバー |  |
| RQ-039 | Resolved→Closed が可能 | Must | TCND-009 | TC-013 | カバー |  |
| RQ-040 | Open→Closed は禁止 | Must | TCND-010 | TC-014 | カバー |  |
| RQ-041 | Closedからの遷移はすべて禁止 | Must | TCND-010 | TC-015 | カバー |  |
| RQ-042 | 監査ログ（履歴）一覧を閲覧できる | Should | TCND-030;TCND-043 | TC-040 | カバー | 表示/追跡可能性（actor/操作種別/時刻）を確認する。 |

### 補足：関連RQが空のテストケースの扱い
一部のテストケース（例：同時更新/二重操作/整合性など）は、要件CSV（RQ-001〜RQ-042）に明文化されていない品質リスクに基づくリスクベーステストとして定義している。
これらは「要件カバレッジ」には算入しないが、残存リスク評価の根拠としてテスト結果および完了レポートで扱う。

---

## 6. テスト条件（TCND）→テストケース（TC）対応

| TCND ID | 優先度 | リスク | テスト条件 | 関連RQ | 関連TC | カバレッジ |
| --- | --- | --- | --- | --- | --- | --- |
| TCND-001 | P1 | 権限 | 依頼者は自分のチケット詳細のみ参照できる | RQ-015 | TC-001 | カバー |
| TCND-002 | P1 | 権限 | 依頼者は他人のチケット詳細にアクセスできない（直接URL/ID指定含む） | RQ-015 | TC-002;TC-003 | カバー |
| TCND-003 | P1 | 権限 | 依頼者はステータス変更できない（UI/直接操作の双方） | RQ-026 | TC-004;TC-005 | カバー |
| TCND-004 | P1 | 権限 | 担当者は全チケットを参照できる（仕様どおり） | RQ-016 | TC-006 | カバー |
| TCND-005 | P1 | 権限 | 担当割当（Assign）は管理者のみ実行できる | RQ-007;RQ-033;RQ-030;RQ-027 | TC-007;TC-008 | カバー |
| TCND-006 | P1 | 状態遷移 | Open→In Progress / Pending の許可遷移ができる | RQ-035;RQ-036 | TC-009;TC-010 | カバー |
| TCND-007 | P1 | 状態遷移 | In Progress→Pending / Resolved の許可遷移ができる | RQ-035;RQ-037 | TC-011 | カバー |
| TCND-008 | P1 | 状態遷移 | Pending→In Progress の許可遷移ができる | RQ-035;RQ-038 | TC-012 | カバー |
| TCND-009 | P1 | 状態遷移 | Resolved→Closed の許可遷移ができる | RQ-035;RQ-039 | TC-013 | カバー |
| TCND-010 | P1 | 状態遷移 | 禁止遷移（例：Open→Closed、Closed→任意）は拒否される | RQ-035;RQ-040;RQ-041 | TC-014;TC-015 | カバー |
| TCND-011 | P1 | 整合性 | 同一チケットを別セッションで更新したとき、整合性が破綻しない（競合時の扱いが仕様どおり） | - | TC-016;TC-017 | カバー |
| TCND-012 | P1 | 整合性 | 同時にステータス変更が走っても、最終状態と履歴が整合する | - | TC-018;TC-019 | カバー |
| TCND-013 | P2 | 入力 | 依頼者が必須項目を満たしてチケットを作成できる | RQ-003;RQ-004;RQ-005;RQ-012 | TC-020 | カバー |
| TCND-014 | P2 | 入力 | 必須不足の場合、作成できずエラーが表示される | RQ-003;RQ-004 | TC-021 | カバー |
| TCND-015 | P2 | 入力 | タイトルの境界値（最大長ちょうど/超過）の受理・拒否が正しい | RQ-003 | TC-022;TC-023 | カバー |
| TCND-016 | P2 | 入力 | 本文の境界値（最大長ちょうど/超過）の受理・拒否が正しい | RQ-004 | - | 未カバー |
| TCND-017 | P2 | 入力 | 期限が過去日の場合、作成できずエラーとなる | RQ-006 | TC-024 | カバー |
| TCND-018 | P2 | 入力 | 添付ファイル：サイズ上限超過は拒否される | RQ-008;RQ-010 | TC-025 | カバー |
| TCND-019 | P2 | 入力 | 添付ファイル：許可形式以外は拒否される（または安全に扱われる） | RQ-009 | TC-026 | カバー |
| TCND-020 | P2 | 検索 | 依頼者の一覧には自分のチケットのみ表示される | RQ-015 | TC-027 | カバー |
| TCND-021 | P2 | 検索 | キーワード検索（部分一致）が期待どおりに絞り込める | RQ-018 | TC-028 | カバー |
| TCND-022 | P2 | 検索 | 状態フィルタが期待どおりに絞り込める | RQ-019 | TC-029 | カバー |
| TCND-023 | P2 | 検索 | ソート（更新日時など）が期待どおりである | - | - | 未カバー |
| TCND-024 | P2 | 履歴 | コメントを追加でき、詳細画面に表示される | RQ-021;RQ-023 | TC-030 | カバー |
| TCND-025 | P2 | 履歴 | ステータス変更が履歴として残り、表示される | RQ-002;RQ-025;RQ-042 | TC-040 | カバー |
| TCND-026 | P3 | 表示 | 権限がない操作は、分かりやすい抑止表示またはエラーとなる | - | - | 未カバー |
| TCND-027 | P3 | 検索 | 件数が多い場合でも一覧表示が破綻しない（簡易確認） | - | - | 未カバー |
| TCND-028 | P3 | 表示 | エラー文言がユーザに理解可能な内容になっている（簡易確認） | - | - | 未カバー |
| TCND-029 | P1 | 権限/認証 | ログイン必須（未ログインは一覧/詳細/作成/更新/コメントにアクセスできない） | RQ-001 | TC-031;TC-032;TC-033 | カバー |
| TCND-030 | P2 | 履歴 | 監査ログ（履歴）一覧がチケット詳細で閲覧できる（閲覧権限に従う） | RQ-042 | TC-040 | カバー |
| TCND-031 | P2 | 入力 | 添付は1ファイルのみ（複数添付は拒否） | RQ-008 | - | 未カバー |
| TCND-032 | P2 | 入力 | 添付は作成後に削除/差し替えできない（UIなし/直叩き拒否） | RQ-011 | TC-041 | カバー |
| TCND-033 | P1 | 認可 | Agentはチケットを作成できない（UIなし/直叩き拒否） | RQ-013 | TC-034 | カバー |
| TCND-034 | P2 | 認可 | Adminはチケットを作成できる（運用上必要なら） | RQ-014 | - | 未カバー |
| TCND-035 | P1 | 認可 | Adminは全チケットを閲覧できる（一覧/詳細） | RQ-017 | TC-035 | カバー |
| TCND-036 | P2 | 表示 | 詳細画面の表示項目（title/body/status/due_date/assignee/attachment）が仕様どおり | RQ-020 | TC-039 | カバー |
| TCND-037 | P1 | 認可 | Requesterは他人チケットにコメントできない（UI/直叩き拒否） | RQ-022 | TC-036 | カバー |
| TCND-038 | P2 | 機能 | Adminは任意チケットにコメントできる | RQ-024 | - | 未カバー |
| TCND-039 | P1 | 認可 | Requesterは期限変更できない（更新UIなし/直叩き拒否） | RQ-028 | - | 未カバー |
| TCND-040 | P1 | 認可 | Agentは担当チケットのみ更新できる（非担当は拒否） | RQ-029 | TC-037 | 一部 |
| TCND-041 | P1 | 制約 | 担当未割当チケットはAgentがステータス変更できない | RQ-034 | TC-038 | カバー |
| TCND-042 | P1 | 認可 | Adminは全チケットを更新できる（status/assignee/due_date等） | RQ-032 | - | 未カバー |
| TCND-043 | P2 | 履歴 | 監査ログの操作種別（CREATED/STATUS_CHANGED/ASSIGNED/COMMENT_ADDED等）が正しく記録される | RQ-002;RQ-025;RQ-042 | TC-040 | 一部 |
| TCND-044 | P2 | 入力 | 本文の境界値（最大長ちょうど/超過）を確認する | RQ-004 | - | 未カバー |

---

## 7. カバレッジ

要件（全42件）に対し、現行のテスト条件/テストケースでのカバレッジは以下。

- カバー：30件
- 一部カバー：7件
- 未カバー：5件

- 未カバー要件：RQ-014;RQ-024;RQ-028;RQ-031;RQ-032
- 一部カバー要件：RQ-002;RQ-004;RQ-005;RQ-006;RQ-008;RQ-027;RQ-029

---

## 8. 未カバー/一部カバーの扱い

未カバー/一部カバーは、以下のどれかに必ず分類して扱う。

- **A. テスト条件・テストケースを追加してカバーする**（Mustの要件、リスク優先）
- **B. スコープ外として明記する**（MVP外、将来機能、工数都合など）
- **C. 要件自体を修正・明確化する**（ロール/運用/実装がズレている等）

特に、現状の論点として以下は早めに整理する。

- `RQ-006（due_dateはAdmin）` と、現行TC（Requester作成でdue_date入力）の前提が一致していない  
  → **「作成時はRequesterも入力可」なのか、「Adminのみ」なのか**を決め、要件/TC/実装を揃える。

- 監査ログ（`RQ-002`）は主要操作での確認は可能になったが、**「全操作」網羅の観点では未完**  
  → 追加候補：期限変更/担当再割当/添付ありなし など、要件の範囲に応じて検証範囲を確定する。

- `RQ-029（Agentは担当のみ更新）` は「非担当のステータス変更拒否」は確認できるが、更新定義（コメント追加も含む）まで含めると **一部**  
  → 追加候補：非担当でのコメント追加拒否（または仕様としてコメントは例外とする、など要件明確化）。

---

## 9. 追加候補のテスト条件（Backlog）

※本章は「未カバー／一部カバー」の解消候補のみを残す。

| 追加候補TCND | 優先度 | リスク | テスト条件案 | 対象要件 | 対応TC案 |
| --- | --- | --- | --- | --- | --- |
| TCND-031 | P2 | 入力 | 添付は1ファイルのみ（複数添付は拒否） | RQ-008 | TC-追加 |
| TCND-034 | P2 | 認可 | Adminはチケットを作成できる（運用上必要なら） | RQ-014 | TC-追加（または対象外化） |
| TCND-038 | P2 | 機能 | Adminは任意チケットにコメントできる | RQ-024 | TC-追加 |
| TCND-039 | P1 | 認可 | Requesterは期限変更できない（更新UIなし/直叩き拒否） | RQ-028 | TC-追加 |
| TCND-042 | P1 | 認可 | Adminは全チケットを更新できる（status/assignee/due_date等） | RQ-032 | TC-追加 |
| TCND-044 | P2 | 入力 | 本文の境界値（最大長ちょうど/超過）を確認する | RQ-004 | TC-追加 |



