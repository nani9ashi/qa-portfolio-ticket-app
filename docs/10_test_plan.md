# テスト計画書 - チケット管理アプリ

- 文書ID：TP-TICKET-001
- 版：v0.1
- ステータス：Draft
- 最終更新日：2025-12-31
- 作成者：仁後慎太郎
- 対象：チケット管理アプリ（Web, Django + SQLite）
- 関連：
  - 要件：`../requirements/requirements.csv`
  - 要件とテストのトレーサビリティ：`../docs/70_requirements_test_traceability.md`
  - テスト条件：`../docs/20_test_conditions.md`
  - テスト設計：`../docs/30_test_design.md`
  - テストケース：`../testcases/testcases.csv`
  - テスト結果：`../results/test_results.csv`
  - 欠陥ログ：`../defects/defect_log.csv`

---

## 1. 目的

本テストは、チケット管理アプリの主要な利用シナリオに対して、重大な欠陥（defect）を早期に検出し、残存リスクを可視化することを目的とする。特に、以下の品質リスクを優先して確認する。

- 権限制御（他人のチケットを閲覧・更新できてしまう）
- 状態遷移（不正な遷移、二重更新、戻し操作の破綻）
- データ整合性（同時更新、一覧・検索結果の不整合）

---

## 2. テスト対象

### 2.1 想定ユーザ
- 依頼者（Requester）：チケット作成・参照
- 担当者（Agent）：ステータス変更・コメント・担当割当
- 管理者（Admin）：ユーザ管理・設定管理

### 2.2 主要機能（MVP）
- チケット作成（タイトル、本文、カテゴリ、優先度、期限、添付）
- 一覧、検索、フィルタ（状態、担当、期限切れ）
- ステータス変更（Open → In Progress → Pending → Resolved → Closed）
- コメント、履歴（変更内容の記録）
- 権限制御（ロール別の閲覧・更新）

---

## 3. テストベース

期待結果の根拠として、以下をテストベースとする。

- 要件：`../requirements/requirements.csv`
- テスト条件：`../docs/20_test_conditions.md`
- 要件とテストのトレーサビリティ：`../docs/70_requirements_test_traceability.md`
- 画面・項目仕様（最小）
- 状態遷移定義
- 入力制約（必須、文字数、添付サイズなど）
- 権限マトリクス（ロール×操作）

---

## 4. スコープ

### 4.1 対象範囲
- 主要機能（2.2）に対する機能テスト（system testing相当）
- 権限に関するセキュリティ観点（認可、直接URLアクセス等の基本確認）
- 互換性（主要ブラウザ差分の基本確認）
- 探索的テスト（チャーターに基づく追加確認）
- Should要件は、運用方針により採否を決定する（一次ソース：トレーサビリティ（70）のBacklog分類）
  - 採用する場合：テスト条件/テストケースを追加して対象に含める
  - 採用しない場合：スコープ外として明記し、残存リスクとして扱う


### 4.2 対象外
- 負荷試験（性能・スケーラビリティの定量評価）
- 専門的な脆弱性診断（侵入テスト等）
- 複雑な承認フローなど、MVP外の業務例外

---

## 5. リスクレジスター

| リスクID | リスク内容 | 影響 | 起こりやすさ | 優先度 | 主な緩和策（テスト） |
| --- | --- | --- | --- | --- | --- |
| R-01 | 認可不備により他人チケットを閲覧/更新/コメントできてしまう（IDOR含む） | 高 | 中 | 最優先 | ロール×操作のデシジョンテーブル、直接URL/ID改変、直叩き（POST/GET）での拒否確認 |
| R-02 | 状態遷移の制約不備（禁止遷移が通る／Closedから戻る等） | 高 | 中 | 最優先 | 状態遷移テスト（許可/禁止の網羅）、担当未割当の制約確認 |
| R-03 | 競合更新・二重送信で状態/履歴（監査ログ）が不整合になる | 中 | 中 | 高 | 2セッション同時更新、連打、競合時の仕様確認（拒否/上書き/整合） |
| R-04 | 一覧/検索/フィルタの不整合（表示漏れ・誤表示・情報漏えい） | 中 | 中 | 中 | 同値分割・境界値、ロール別の表示範囲、検索語/フィルタ組合せ確認 |
| R-05 | 添付の制約不備（形式/サイズ/ファイル数）により不正ファイルが混入する | 中 | 低 | 中 | 形式/サイズ/未添付/異常系、1ファイル制約、作成後の差替/削除不可確認 |
| R-06 | 監査ログ不備（記録漏れ/種別誤り/actor不正）により追跡性が損なわれる | 中 | 中 | 高 | 主要操作ごとのログ種別確認（CREATED/ASSIGNED/STATUS_CHANGED/COMMENT_ADDED等）、表示内容（誰が/いつ/何を）確認 |

---

## 6. テストアプローチ

### 6.1 テストタイプ
- 機能テスト：作成・一覧・検索・遷移・コメント・権限
- 互換性（基本）：Chrome/Edge（任意でFirefox）
- セキュリティ（基本）：認可、入力値の妥当性（例：必須、サイズ、URL直叩き）
- ユーザビリティ（簡易）：文言、エラー表示、操作の分かりやすさ

### 6.2 テスト技法
- 同値分割・境界値分析（文字数、期限、添付サイズなど）
- 状態遷移テスト（statusの許可/禁止遷移）
- デシジョンテーブル（ロール×操作）
- 探索的テスト（チャーター：30分×2本）

### 6.3 テスト条件〜テストケースの作り方
- まずテストベースからテスト条件（test condition）を作成
- テスト条件を満たすテストケース（test case）を設計し、必要なテストデータを定義
- リスク優先度に基づき、テストケースを優先度付けして実行順を決める

### 6.4 リグレッションテスト
欠陥修正、または機能変更時に、影響の大きいフロー（作成・遷移・権限・検索）の代表ケースを再実行する。

### 6.5 自動化（段階的導入）
- 手動で安定した代表シナリオを確定後、UI E2E（Playwright）を2〜3本作成
- 自動化の対象は「高頻度で実行」「期待結果が明確」「不安定要因が少ない」ものから選ぶ
- 将来的にGitHub ActionsでCI実行し、結果を残す

---

## 7. 開始基準・終了基準

### 7.1 開始基準
- SUTがローカルで起動できる（Docker Compose）
- テスト用アカウント（依頼者/担当者/管理者）が利用可能
- seedデータ投入が完了している
- 対象機能（2.2）が最低限操作可能である（主要画面が表示できる）

### 7.2 終了基準
- 優先度「最優先」リスク（R-01〜R-03）に対する必須ケースの実行が完了
- 未解決の重大欠陥（Severity：Critical/High）がゼロ、または回避策・受容の合意がある
- テスト完了レポート（test completion report）に、実行結果と残存リスクが記載されている

---

## 8. テスト環境とテストデータ

### 8.1 テスト環境
- ローカル起動：Docker Compose
- ブラウザ：Chrome / Edge（任意でFirefox）
- 証跡：スクリーンショット、必要に応じて短い録画

### 8.2 テストデータ（例）
- アカウント：Requester/Agent/Admin を各1つ以上
- チケット：未対応・対応中・保留・解決・クローズを各数件
- 検索用データ：カテゴリ違い、期限切れ、担当者別など

---

## 9. 欠陥管理

- 欠陥は「欠陥レポート（defect report）」として記録する
- 重要度（Severity）：影響の大きさ
- 優先度（Priority）：修正の急ぎ度
- 欠陥レポートには、再現手順／期待結果／実結果／環境／証跡を必ず含める

---

## 10. 体制・コミュニケーション

- 体制：1人（計画・設計・実行・報告）
- レポーティング：日次で実行状況を更新し、節目でサマリを作成
- 主要成果物はGitHubで版管理し、変更履歴を残す

---

## 11. モニタリングとコントロール

### 11.1 収集するメトリクス（例）
- 計画/実行/未実行の件数
- Pass/Fail/Blocked
- 重要度別の欠陥件数
- 優先リスク領域のカバレッジ（R-01〜R-03）

### 11.2 レポート
- テスト進捗レポート：節目で更新（簡易でも可）
- テスト完了レポート：終了基準到達時に作成

---

## 12. 作業成果物

- テスト計画書（本書）
- テスト条件
- テスト設計
- テスト環境定義
- テスト実行方針
- テストケース
- テスト結果
- 欠陥ログ
- テスト完了レポート
- 要件とテストのトレーサビリティ

---

## 13. 構成管理

- 主要成果物はGitHubで管理し、版（v0.x）を付与する
- 証跡（スクショ等）は evidence/ に格納し、欠陥レポートやテストケースから参照できるようにする